## MITRE | ATT&CK <a href="https://attack.mitre.org/techniques/T1566/001/">T1566.001</a>
### Tactic: Initial Access 
#### Scenario objective
The objective of this scenario is early detection of malicious files before execution.
This is achieved through VirusTotal integration, real-time File Integrity Monitoring (FIM), and an automated response that removes the infected file.
#### Scenario
The user downloaded a malicious file from an untrusted source or received it via a phishing email, after which the file was saved in the Downloads folder.
This scenario reflects one of the most common real-world infection vectors observed in enterprise environments.
#### Walkthrough 

<b>1.</b> Adding folder monitoring on Windows host in agent.conf  ( * in path for all users in agents ) 
<p><b>PS!</b> We can also add restrict=".exe|.dll|.js|.bat|.ps1" in directories value but for my test i won't</p>

```
  <agent_config os="Windows">
    <syscheck>
      <directories check_all="yes" realtime="yes"> C:\Users\*\Downloads </directories>
    </syscheck>
  </agent_config>
```
alert ⚠ Check.
<img width="1280" height="448" alt="image" src="https://github.com/user-attachments/assets/4f6b59b9-2950-4e93-9304-eb804c9ae2ef" />

<b>2. VirusTotal integration to Wazuh server</b>
<p><b>Requierments: VirusTotal API_KEY</b>
  
```
<integration>
  <name>virustotal</name>
  <api_key>API_KEY</api_key> <!-- Replace with your VirusTotal API key -->
  <group>syscheck</group>
  <alert_format>json</alert_format>
</integration>
```

Integration Check ⚠ 
<img width="951" height="686" alt="image" src="https://github.com/user-attachments/assets/d7c438be-c399-4a69-8ff7-3878aafdc919" />

<b>ISSUE in FIM testing</b>
<p>My second host is "Windowds10 Pro" and if you create new file from Explorer it doesn't trigger the FIM event ( on picture yotu see files 0kb ) so i used poweshell with some value in it and instantly got event in Wazuh</p>
<img width="1124" height="957" alt="win10proFIM" src="https://github.com/user-attachments/assets/32ae7828-5e97-4c7c-8740-f75e11096383" />
( Wazuh screenshot ) 
<img width="1913" height="555" alt="image" src="https://github.com/user-attachments/assets/fd8dd985-ad65-457d-9b5c-2c8559e27ab2" />


